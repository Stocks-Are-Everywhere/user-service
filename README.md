# User-service

### 🔖 서비스 개요
  - **주제**: 사용자 관리 및 계좌 서비스
  - **주요 역할**: 
    - 사용자 인증 및 계정 관리
    - 가상 계좌 생성 및 관리
    - 포트폴리오 관리 및 자산 현황 제공
    - 사용자 설정 및 선호도 관리

</br>

### 🌏 주요 로직
<img width="1157" alt="사용자 서비스 흐름도" src="" />

</br>
</br>

### 🔗 주요 기능  

#### 1️⃣ 사용자 인증 및 계정 관리
- 구글 소셜 로그인 지원 및 JWT 기반 인증 시스템 구현
- 사용자 프로필 정보 관리 및 업데이트 기능 제공
- 보안 강화를 위한 토큰 관리 및 갱신 메커니즘 구현

#### 2️⃣ 가상 계좌 관리
- 회원가입 시 모의 투자용 가상 자금 자동 제공
- 실시간 계좌 잔고 관리 및 업데이트 처리
- 주문 가능 금액 검증 및 계좌 잔액 변동 이벤트 처리

#### 3️⃣ 이벤트 처리 및 연동
- 주문 서비스와의 연동을 통한 계좌 잔액 검증
- 매칭 서비스로부터 체결 이벤트 수신 및 처리
- RabbitMQ를 활용한 비동기 이벤트 처리 구현


</br>

### 🌈 개선 사항

  #### 1️⃣ 배치 성능 최적화 - <ins>실행 시간 약 84% 감소</ins>

  </br>

  **문제 상황**
  - 정기 결제 및 사용권 초기화를 배치로 처리하고 있는데, 현재는 배치 로직도 엄청 복잡하지 않고, 데이터 양도 많지 않지만, 나중에 데이터가 많아지게될 경우 성능 저하가 우려됨

  **1. 순차처리 → 병렬처리**
  - 기존에 순차적으로 진행하던 작업을 병렬로 처리

  **결과**
  
  <img width="742" alt="스크린샷 2024-12-17 15 33 20" src="https://github.com/user-attachments/assets/ef411e3b-e757-47df-8572-8102f83dc10d" />

</br>  

  #### 3️⃣ GitHub API를 통해 사용자 레포지토리 목록 조회 성능 개선 - <ins>응답속도 약 60배 개선</ins>
  
</br>

  **문제 상황**
  - GitHub API를 사용해서 조회하는 것인데

</br>

  **문제 해결**
  - 레포지토리 목록은 

</br>

  #### 4️⃣ 검색 필터 조회 성능 개선 - <ins>약 55.4% 개선</ins>
  - 캐싱 시도
    - 필터 자체를 캐싱하자니 Cache Hit 확률이 너무 낮아 성능 개선이 안됨
   
</br>

  **<개선 전>**
  <img width="1337" alt="스크린샷 2024-11-12 11 06 11" src="https://github.com/user-attachments/assets/c8d814f9-6273-4dc6-86c2-750fbef3c266">


  **<개선 후>**

</br>

### 🚀 트러블 슈팅

  #### 1️⃣ **조회수 집계 구현시 동일 사용자가 새로고침할 때마다 계속해서 조회수가 증가**
  - 특정한 조건 없이 해당 이력서를 조회할 때마다 조회수가 올라가는 것은 조회수 정보의 신뢰성을 떨어뜨릴 수 있다고 판단

  #### 2️⃣ **MongoDB에서 페이지네이션 적용시 10만건 데이터 기준 총 8000 페이지에서 약 4000 페이지부터 메모리 관련 에러 발생**
  #### 3️⃣ **배치 작업 시 Kafka와 Spring Batch의 트랜잭션 충돌 문제 발생**
